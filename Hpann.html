<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cricketsparx</title>
  <link rel="icon" href="https://upload.wikimedia.org/wikipedia/commons/thumb/8/82/Telegram_logo.svg/2048px-Telegram_logo.svg.png" type="image/png" sizes="250x250" />

  <!-- Shaka Player -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/shaka-player.ui.min.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/controls.min.css" crossorigin="anonymous">

  <!-- Google Material Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Material+Icons+Round" rel="stylesheet">

  <style>
    body { margin: 0; background: black; }

    /* Hide the default three-dot menu icon */
    .shaka-overflow-menu-button svg { display: none !important; }
    .shaka-overflow-menu-button { order: 1; }
    .shaka-fullscreen-button { order: 2; }

    .shaka-spinner { display: none !important; }
    .shaka-mute-button { transform: scale(1.16); }
    .shaka-overflow-menu-button { transform: scale(1.11); }
    .shaka-fullscreen-button { transform: scale(1.3); }

    /* Replace overflow menu icon with settings gear */
    .shaka-overflow-menu-button::before {
      content: "settings";
      font-family: 'Material Icons Round';
      font-size: 24px;
      color: rgb(250, 250, 250);
      display: flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      line-height: 36px;
      position: relative;
      top: -2.2px;
    }
  </style>
</head>
<body>
  <!-- Player Container -->
  <div id="player-container" data-shaka-player-container style="position:absolute; top:0; left:0; width:100%; height:100%; object-fit:cover">
    <video autoplay muted data-shaka-player id="video" poster="https://i.postimg.cc/HsXzwPrZ/Picsart-25-03-24-11-00-15-300.jpg" style="width:100%; height:100%;"></video>
  </div>

  <script>    
    document.addEventListener('DOMContentLoaded', async () => {    
      shaka.polyfill.installAll();    
    
      if (!shaka.Player.isBrowserSupported()) {    
        console.error('Browser not supported');    
        return;    
      }    
    
      const video = document.querySelector('video');    
      const player = new shaka.Player();    
      await player.attach(video);    
    
      const container = document.querySelector('.shaka-video-container');    
      const ui = new shaka.ui.Overlay(player, container, video);    
    
      let drmConfig = {    
        clearKeys: {    
          "31b13c6f241055aaa965263f3115e684":"61f0cbc9599925a7be93d45e30b8ebe9"    
        }    
      };    
      let cookieHeader = "__hdnea__=st=1758820205~exp=1758906605~acl=/*~hmac=f2d1d44f339a0eff6bc358bf63e3b001bbd73a525e0c4a64feec2b193e792def";    
      let streamUrl = "https://jiotvbpkmob.cdn.jio.com/bpk-tv/Asia_Cup_Hindi_MOB/WDVLive/index.mpd";    
    
      try {    
        const response = await fetch('');    
        const m3uText = await response.text();    
        const lines = m3uText.split('\n');    
    
        for (let i = 0; i < lines.length; i++) {    
          if (lines[i].includes('Star_Sports_HD1')) {    
            for (let j = i - 1; j >= 0; j--) {    
              if (lines[j].startsWith('#EXTHTTP:')) {    
                const cookieMatch = lines[j].match(/"cookie":"([^"]+)"/);    
                if (cookieMatch) {    
                  cookieHeader = cookieMatch[1];    
                }    
                break;    
              }    
            }    
            break;    
          }    
        }    
      } catch (error) {    
        console.error('Failed to fetch M3U:', error);    
      }    
    
      player.configure({    
        drm: drmConfig,    
        streaming: {    
          lowLatencyMode: true,    
          bufferingGoal: 15,    
          rebufferingGoal: 2,    
          bufferBehind: 15,    
          retryParameters: {    
            timeout: 10000,    
            maxAttempts: 5,    
            baseDelay: 300,    
            backoffFactor: 1.2    
          },    
          segmentRequestTimeout: 8000,    
          segmentPrefetchLimit: 2,    
          useNativeHlsOnSafari: true    
        },    
        manifest: {    
          retryParameters: {    
            timeout: 8000,    
            maxAttempts: 3    
          }    
        }    
      });    
    
      player.getNetworkingEngine().registerRequestFilter((type, request) => {    
        request.headers['Referer'] = 'https://www.jiotv.com/';    
        request.headers['User-Agent'] = "plaYtv/7.1.5 (Linux;Android 12) ExoPlayerLib/2.11.7";    
        request.headers['Cookie'] = cookieHeader;    
    
        if (    
          (type === shaka.net.NetworkingEngine.RequestType.MANIFEST ||    
            type === shaka.net.NetworkingEngine.RequestType.SEGMENT) &&    
          request.uris[0] && !request.uris[0].includes('__hdnea__=')    
        ) {    
          const separator = request.uris[0].includes('?') ? '&' : '?';    
          request.uris[0] += separator + cookieHeader;    
        }    
      });    
    
      const enableAutoplay = () => {    
        video.setAttribute('autoplay', '');    
        video.setAttribute('playsinline', '');    
        video.autoplay = true;    
      };    
    
      const attemptAutoplay = async () => {    
        try {    
          video.muted = false;    
          await video.play();    
          console.log('Unmuted autoplay successful');    
          return true;    
        } catch (error) {    
          console.log('Unmuted autoplay failed:', error.message);    
          try {    
            video.muted = true;    
            await video.play();    
            console.log('Muted autoplay successful');    
            return true;    
          } catch (mutedError) {    
            console.log('Muted autoplay failed:', mutedError.message);    
            return false;    
          }    
        }    
      };    
    
      player.addEventListener('error', (event) => {    
        console.error('Shaka Player Error:', event.detail);    
      });    
    
      video.addEventListener('play', () => {    
        if (window.self === window.top && !document.fullscreenElement && window.innerWidth <= 768) {    
          container.requestFullscreen().catch(() => {    
            console.log('Fullscreen request failed');    
          });    
        }    
      }, { once: true });    
    
      video.addEventListener('loadedmetadata', () => {    
        video.volume = 0.8;    
      });    
    
      let hasUserInteracted = false;    
      const enableSoundOnInteraction = () => {    
        if (!hasUserInteracted && video.muted) {    
          video.muted = false;    
          hasUserInteracted = true;    
          console.log('Sound enabled after user interaction');    
        }    
      };    
      ['click', 'touchstart', 'keydown'].forEach(event => {    
        document.addEventListener(event, enableSoundOnInteraction, { once: true });    
      });    
    
      try {    
        enableAutoplay();    
        await player.load(streamUrl);    
        if (video.readyState >= 3) {    
          await attemptAutoplay();    
        } else {    
          video.addEventListener('canplay', attemptAutoplay, { once: true });    
          setTimeout(async () => {    
            if (video.paused) {    
              await attemptAutoplay();    
            }    
          }, 2000);    
        }    
      } catch (error) {    
        console.error('Load error:', error);    
      }    
    
      document.addEventListener('visibilitychange', () => {    
        if (!document.hidden && video.paused) {    
          attemptAutoplay();    
        }    
      });    
    });    
  </script>
</body>
</html>
